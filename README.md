# 8891 汽車數據分析系統 🚗

一個完整的汽車列表數據獲取、清理和分析系統，具備**互動式鑽取分析**功能。

## 🚀 新功能亮點

### 🔍 互動式鑽取分析
- **多層級鑽取**: 點擊圖表元素進行深度探索
- **導航麵包屑**: 追蹤分析路徑，輕鬆返回上層
- **多維度分析**: 品牌、地區、年份、價格等多角度分析
- **即時篩選**: 點擊即可篩選，無需重新載入

### 📊 增強視覺化
- **互動樹狀圖**: 支援點擊鑽取的樹狀圖
- **多層級樹狀圖**: 最多3層同時顯示
- **相關性熱力圖**: 數值欄位關聯分析
- **自定義圖表**: 自由組合X/Y軸進行分析

### 🛠️ 進階功能
- **動態洞察**: 即時統計與趨勢分析
- **數據品質報告**: 缺失值檢查
- **進階搜尋**: 多欄位文字搜尋
- **多格式下載**: CSV/JSON格式導出

這是一個完整的汽車數據抓取和分析系統，包含數據抓取器和互動式儀表板。

## 文件結構

```
8891/
├── fetch_8891_csv.py      # 數據抓取器
├── dashboard.py           # Streamlit 儀表板
├── config_8891.json      # 抓取配置
├── requirements.txt       # 依賴包
├── README.md             # 本文件
└── data/                 # 數據目錄
    ├── *.csv            # CSV 數據文件
    └── raw/             # 原始 JSON 數據
        └── dt=YYYY-MM-DD/
            └── *.jsonl  # 原始 JSON 行文件
```

## 安裝依賴

```bash
pip install -r requirements.txt
```

## 使用步驟

### 1. 數據抓取

首先運行數據抓取器獲取車輛數據：

```bash
# 基本使用 - 自動抓取
python fetch_8891_csv.py --config config_8891.json --auto

# 抓取指定頁數
python fetch_8891_csv.py --config config_8891.json --pages 5

# 同時保存原始 JSON 數據
python fetch_8891_csv.py --config config_8891.json --auto --raw-jsonl

# 測試單個請求
python fetch_8891_csv.py --test toyota rav4

# 調試模式
python fetch_8891_csv.py --config config_8891.json --debug --pages 2
```

### 2. 儀表板分析

運行 Streamlit 儀表板進行數據分析：

```bash
streamlit run dashboard.py
```

儀表板會自動在瀏覽器中打開（通常是 http://localhost:8501）

## 儀表板功能

### 📊 主要分析功能

1. **樹狀圖分析 (Treemap)**
   - 按品牌、車系、地區等分組
   - 視覺化車輛分布和平均價格
   - 互動式探索

2. **價格分布分析**
   - 價格直方圖
   - 統計指標（最低、最高、中位數）
   - 價格範圍篩選

3. **年份 vs 價格散點圖**
   - 年份和價格的關係
   - 按品牌顏色區分
   - 里程數大小映射

4. **品牌比較分析**
   - 多指標比較（數量、價格、年份、里程）
   - 子圖形式展示
   - 品牌間差異分析

5. **地區分布分析**
   - 各地區車輛數量
   - 前15名地區排行
   - 地理分布洞察

### 🔍 互動功能

- **數據來源選擇**: CSV、JSON 或合併數據
- **即時篩選**: 品牌、年份、價格範圍
- **數據下載**: 篩選後數據匯出
- **數據表格**: 詳細數據檢視

### 📈 推薦的其他分析

基於您的汽車數據，我建議以下額外分析：

1. **里程 vs 價格關係**
   - 里程對價格的影響
   - 不同品牌的折舊曲線

2. **燃料類型分析**
   - 汽油、柴油、油電混合比例
   - 不同燃料類型的價格差異

3. **變速箱類型分析**
   - 手排、自排、CVT 分布
   - 變速箱對價格的影響

4. **顏色偏好分析**
   - 受歡迎顏色排行
   - 顏色對價格的影響

5. **時間序列分析**
   - 發布時間趨勢
   - 價格時間變化

6. **性價比分析**
   - 年份/價格比
   - 里程/價格比
   - 綜合評分

## 配置說明

### config_8891.json

```json
{
  "defaults": {
    "pages": 2
  },
  "tasks": [
    {
      "brand": "toyota",
      "kind": "rav4", 
      "enabled": true,
      "pages": 2
    }
  ]
}
```

- `enabled`: 是否啟用此品牌/車型的抓取
- `pages`: 抓取頁數（在非自動模式下）
- 可以添加更多品牌和車型組合

## 常見問題

### 1. SSL 錯誤
如果遇到 SSL 證書錯誤，腳本已經自動設置 `verify=False` 來解決。

### 2. 中文亂碼
腳本已經優化中文字符處理：
- 使用 UTF-8-BOM 編碼保存 CSV
- 自動清理編碼問題
- Windows 終端 UTF-8 支持

### 3. 沒有數據
- 確認網絡連接
- 檢查 config 中的品牌/車型名稱
- 使用 `--test` 模式測試 API 響應

### 4. 儀表板沒有數據
- 確認 ./data 目錄存在且有 CSV 文件
- 檢查文件編碼是否正確
- 嘗試不同的數據來源選項

## 數據字段說明

| 字段名 | 說明 | 類型 |
|--------|------|------|
| item_id | 車輛唯一ID | 整數 |
| brand | 品牌 | 字符串 |
| series | 車系 | 字符串 |
| model | 車型 | 字符串 |
| year | 年份 | 整數 |
| mileage_km | 里程數(公里) | 整數 |
| price_ntd | 價格(新台幣萬元) | 整數 |
| region | 地區 | 字符串 |
| color | 顏色 | 字符串 |
| fuel | 燃料類型 | 字符串 |
| transmission | 變速箱 | 字符串 |
| post_at | 發布日期 | 字符串 |
| renew_at | 更新日期 | 字符串 |
| views_today | 今日瀏覽 | 整數 |
| views_total | 總瀏覽 | 整數 |
| title | 標題 | 字符串 |

## 技術特性

- **容錯性**: 自動處理編碼和網絡錯誤
- **增量更新**: 避免重複抓取相同數據
- **調試支持**: 詳細的日誌和測試模式
- **多數據源**: 支持 CSV 和原始 JSON 數據
- **響應式設計**: 儀表板適配不同屏幕尺寸
- **中文支持**: 完整的中文字符支持

## 擴展建議

1. **添加更多圖表類型**
   - 熱力圖
   - 雷達圖
   - 箱線圖

2. **機器學習集成**
   - 價格預測模型
   - 車輛推薦系統
   - 異常檢測

3. **實時更新**
   - 定時任務自動抓取
   - 實時儀表板刷新

4. **數據庫集成**
   - PostgreSQL/MySQL 存儲
   - 數據版本管理
